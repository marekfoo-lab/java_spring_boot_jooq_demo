--Sequences
CREATE SEQUENCE ACCOUNT_ID_SEQ INCREMENT 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 100 CACHE 1;

CREATE SEQUENCE ADDRESS_ID_SEQ INCREMENT 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 100 CACHE 1;

CREATE SEQUENCE ROLE_ID_SEQ INCREMENT 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 100 CACHE 1;

CREATE SEQUENCE LOGIN_HISTORY_ID_SEQ INCREMENT 1 MINVALUE 1 MAXVALUE 9223372036854775807 START WITH 100 CACHE 1;

-- ACCOUNT
CREATE TABLE ACCOUNT
  (
     ID           int PRIMARY KEY DEFAULT NEXTVAL ('ACCOUNT_ID_SEQ'),
     LOGIN        varchar(30)  NOT NULL UNIQUE,
     FIRST_NAME   varchar(50),
     LAST_NAME    varchar(70),
     PASSWORD     varchar(50),
     EMAIL        varchar(60)
  );

-- ADDRESS: ManyToOne ACCOUNT.
CREATE TABLE ADDRESS
  (
     ID           int PRIMARY KEY DEFAULT NEXTVAL ('ADDRESS_ID_SEQ'),
     STREET       varchar(70)  NOT NULL,
     ZIP_CODE     varchar(10),
     CITY         varchar(70),
     ADDRESS_TYPE varchar(20)  NOT NULL,
     ACCOUNT_ID   int          NOT NULL
  );

--ManyToMany ACCOUNT-Role
CREATE TABLE ROLE
  (
     ID           int PRIMARY KEY DEFAULT NEXTVAL ('ROLE_ID_SEQ'),
     NAME         varchar(30)  NOT NULL UNIQUE
  );

CREATE TABLE ROLE_ACCOUNT
  (
     ROLE_ID      int  NOT NULL,
     ACCOUNT_ID   int  NOT NULL,
     PRIMARY KEY (ROLE_ID, ACCOUNT_ID)
  );

-- LOGIN_HISTORY: ManyToOne ACCOUNT
CREATE TABLE LOGIN_HISTORY
  (
     ID           int PRIMARY KEY DEFAULT NEXTVAL ('LOGIN_HISTORY_ID_SEQ'),
     ACCOUNT_ID   int          NOT NULL,
     LAST_LOGIN   timestamp    NOT NULL,
     IP_ADDRESS   varchar(39)  NULL,
     IS_SUCCESS   varchar(1)   NOT NULL
  );

-- FK constraints
ALTER TABLE ROLE_ACCOUNT
  ADD CONSTRAINT ROLE_ROLE_ACCOUNT_FK FOREIGN KEY (ROLE_ID) REFERENCES ROLE(ID);

ALTER TABLE ROLE_ACCOUNT
  ADD CONSTRAINT ACCOUNT_ROLE_ACCOUNT_FK FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ID);

ALTER TABLE ADDRESS
  ADD CONSTRAINT ADDRESS_FK FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ID);

ALTER TABLE LOGIN_HISTORY
  ADD CONSTRAINT LOGIN_HISTORY_FK FOREIGN KEY (ACCOUNT_ID) REFERENCES ACCOUNT(ID);

-- Unique constraints
ALTER TABLE ADDRESS
  ADD CONSTRAINT ADDRESS_TYPE_USER_UQ UNIQUE (ACCOUNT_ID, ADDRESS_TYPE);