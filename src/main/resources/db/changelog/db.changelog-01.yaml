databaseChangeLog:

  # ============================================================
  # ACCOUNT
  # ManyToMany: role
  # OneToMany: address
  # OneToMany: login_history
  # ============================================================
  - changeSet:
      id: 092524-01
      author: marekfoo-lab
      changes:
        - createSequence:
            sequenceName: account_id_seq
            startValue: 1
            incrementBy: 1

        - createTable:
            tableName: account
            columns:
              - column:
                  name: id
                  type: int
                  defaultValueComputed: "nextval('account_id_seq')"
                  constraints:
                    primaryKey: true
                    nullable: false

              - column:
                  name: login
                  type: varchar(30)
                  constraints:
                    nullable: false
                    unique: true

              - column:
                  name: first_name
                  type: varchar(50)

              - column:
                  name: last_name
                  type: varchar(70)

              - column:
                  name: password
                  type: varchar(50)
                  constraints:
                    nullable: false

              - column:
                  name: email
                  type: varchar(60)
                  constraints:
                    nullable: false
                    unique: true

  # ============================================================
  # ADDRESS (ManyToOne -> account)
  # ============================================================
  - changeSet:
      id: 092524-03
      author: marekfoo-lab
      changes:
        - createSequence:
            sequenceName: address_id_seq
            startValue: 1
            incrementBy: 1

        - createTable:
            tableName: address
            columns:
              - column:
                  name: id
                  type: int
                  defaultValueComputed: "nextval('address_id_seq')"
                  constraints:
                    primaryKey: true
                    nullable: false

              - column:
                  name: street
                  type: varchar(70)
                  constraints:
                    nullable: false

              - column:
                  name: zip_code
                  type: varchar(10)

              - column:
                  name: city
                  type: varchar(70)

              - column:
                  name: address_type
                  type: varchar(20)
                  constraints:
                    nullable: false

              - column:
                  name: account_id
                  type: int
                  constraints:
                    nullable: false

  - changeSet:
      id: 092524-05
      author: marekfoo-lab
      changes:
        - addForeignKeyConstraint:
            constraintName: fk_address_account
            baseTableName: address
            baseColumnNames: account_id
            referencedTableName: account
            referencedColumnNames: id

  - changeSet:
      id: 092524-06
      author: marekfoo-lab
      changes:
        - addUniqueConstraint:
            constraintName: uq_address_account_type
            tableName: address
            columnNames: account_id, address_type

  # ============================================================
  # ROLE
  # ============================================================
  - changeSet:
      id: 092524-07
      author: marekfoo-lab
      changes:
        - createSequence:
            sequenceName: role_id_seq
            startValue: 1
            incrementBy: 1

        - createTable:
            tableName: role
            columns:
              - column:
                  name: id
                  type: int
                  defaultValueComputed: "nextval('role_id_seq')"
                  constraints:
                    primaryKey: true
                    nullable: false

              - column:
                  name: name
                  type: varchar(30)
                  constraints:
                    nullable: false
                    unique: true

  # ============================================================
  # ROLE_ACCOUNT (ManyToMany)
  # ============================================================
  - changeSet:
      id: 092524-08
      author: marekfoo-lab
      changes:
        - createTable:
            tableName: role_account
            columns:
              - column:
                  name: role_id
                  type: int
                  constraints:
                    nullable: false

              - column:
                  name: account_id
                  type: int
                  constraints:
                    nullable: false

  - changeSet:
      id: 092524-09
      author: marekfoo-lab
      changes:
        - addPrimaryKey:
            constraintName: pk_role_account
            tableName: role_account
            columnNames: role_id, account_id

  - changeSet:
      id: 092524-10
      author: marekfoo-lab
      changes:
        - addForeignKeyConstraint:
            constraintName: fk_role_account_role
            baseTableName: role_account
            baseColumnNames: role_id
            referencedTableName: role
            referencedColumnNames: id

  - changeSet:
      id: 092524-11
      author: marekfoo-lab
      changes:
        - addForeignKeyConstraint:
            constraintName: fk_role_account_account
            baseTableName: role_account
            baseColumnNames: account_id
            referencedTableName: account
            referencedColumnNames: id

  # ============================================================
  # LOGIN_HISTORY (ManyToOne -> account)
  # ============================================================
  - changeSet:
      id: 092524-12
      author: marekfoo-lab
      changes:
        - createSequence:
            sequenceName: login_history_id_seq
            startValue: 1
            incrementBy: 1

        - createTable:
            tableName: login_history
            columns:
              - column:
                  name: id
                  type: int
                  defaultValueComputed: "nextval('login_history_id_seq')"
                  constraints:
                    primaryKey: true
                    nullable: false

              - column:
                  name: account_id
                  type: int
                  constraints:
                    nullable: false

              - column:
                  name: last_login
                  type: timestamp
                  constraints:
                    nullable: false

              - column:
                  name: ip_address
                  type: varchar(39)

              - column:
                  name: is_success
                  type: boolean
                  constraints:
                    nullable: false

  - changeSet:
      id: 092524-13
      author: marekfoo-lab
      changes:
        - addForeignKeyConstraint:
            constraintName: fk_login_history_account
            baseTableName: login_history
            baseColumnNames: account_id
            referencedTableName: account
            referencedColumnNames: id